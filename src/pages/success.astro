---
import SpanishLayout from "../layouts/SpanishLayout.astro";
import Footer from "../components/Footer.astro";
---

<SpanishLayout title="Otros anuncios">
  <figure> 
  <h1>¡Suscripción creada exitosamente!</h1>
  <div id="qr-container"></div>
  <br />
  <button id="download-btn" class="btn descargar">Descargar QR</button>
  </figure>
  <Footer />
</SpanishLayout>
<script>
  import "../scripts/mainMenu.js"
  // Mostrar el QR en el cliente
  const params = new URLSearchParams(window.location.search);
  const qr = params.get('qr');
  if (qr) {
    document.getElementById('qr-container').innerHTML = `<img src="${decodeURIComponent(qr)}" alt="QR de suscripción" />`;
  } else {
    document.getElementById('qr-container').innerHTML = `<p>No se recibió el QR.</p>`;
  }
  // Funcionalidad para descargar el QR
  document.getElementById('download-btn').addEventListener('click', async () => {
  const qrUrl = decodeURIComponent(qr);
  try {
    const response = await fetch(qrUrl);
    const blob = await response.blob();
    const blobUrl = URL.createObjectURL(blob);

    const link = document.createElement('a');
    link.href = blobUrl;
    link.download = 'subscription-qr.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    // Limpia el objeto URL después de usarlo
    URL.revokeObjectURL(blobUrl);
  } catch (error) {
    console.error('Error al descargar el QR:', error);
    alert('Hubo un problema al intentar descargar el QR.');
  }
});
</script>

<style lang="scss">
  @use "../assets/sass/index" as *;
figure {
  text-align: center;
  margin-top: 50px;
  height: 100vh;
}

h1 {
  font-size: 2.5rem;
  margin-bottom: 70px;
}

</style>